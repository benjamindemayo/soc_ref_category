---
title: "socref_cat pilot data analysis"
author: "Benny, Emily, Mike"
date: "August 9, 2017"
output:
  html_document: default
  pdf_document: default
---

Analysis of pilot data after 7/25/17, at which date the paradigm was:

* 34 trials - 28 test plus 6 training
* breaks between blocks to reintroduce prototypes
* additional motivational incentives (stickers)
* no prototypes on boxes
* images are monochrome (blue)

# Preliminaries 

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```

```{r, libraries}
library(ggplot2)
library(langcog)
library(tidyverse)
library(lme4)
library(ggthemes)
library(magrittr)
library(lubridate)
library(stringr)
```

# Data Prep

Read in data and key.

```{r}
# d_raw is child data before being linked to key
d_raw <- read_csv("../data/soc_ref_cat_pilot_data.csv")
key <- read_csv("soc_ref_cat_key.csv")
#use read_csv instead of read.csv
```

Merge data with key.

```{r}
d <- left_join(d_raw, key) %>%
  mutate(response = ifelse(response=="", NA, response), 
         creature = as.character(creature))
#set missing values to NA, change "creature" data type to character

#create answer variable that translates r/b/g to x/y based on condition.
d$answer[d$response == "b" & d$xbox_color == "b"] <- "x"
d$answer[d$response == "b" & d$ybox_color == "b"] <- "y"
d$answer[d$response == "r" & d$xbox_color == "r"] <- "x"
d$answer[d$response == "r" & d$ybox_color == "r"] <- "y"
d$answer[d$response == "g" & d$xbox_color == "g"] <- "x"
d$answer[d$response == "g" & d$ybox_color == "g"] <- "y"

#syntax for d%<>%: equivalent to d <- d %>%
d %<>%
  mutate(acc = (creature == answer)) #creating new bool column, adding it to d
```

Add block. Relevant only for participants collected on or after 7/25

```{r}
d$block <- 0
d$block[d$trial >= 7 & d$trial <= 13] <- 1
d$block[d$trial >= 14 & d$trial <= 20] <- 2
d$block[d$trial >= 21 & d$trial <= 27] <- 3
d$block[d$trial >= 28 & d$trial <= 34] <- 4
```

Filter those participants who were tested using the most recent version of paradigm

```{r}
#lubridate::mdy transforms SID to date of test. str_sub extracts first digits of SID. 
d %<>%
  mutate(dot = lubridate::mdy(str_sub(d$sid, start = 1, end = 6))) %>% #add var dot
  filter(dot > as.Date("2017-07-24")) #take all P's tested after 7/24
```

# Descriptives

```{r}
d %>%
  group_by(sid) %>%
  summarise(n= n())
```

# Analysis

## Main planned analysis

Training trials 

```{r}
training <- filter(d, block == 0) %>%
  group_by(sid) %>%
  summarise(acc = mean(acc, na.rm=TRUE))
  
ggplot(training, aes(x = acc)) +
  geom_histogram(binwidth = .125)
```

Accuracy by morph

```{r}
test <- d %>%
  filter(block > 0, morph > 50) %>%
  group_by(morph, sid) %>% #group first by morph *and* SID to weight each participant equally, not each trial equally.
  summarise(acc = mean(acc, na.rm=TRUE)) %>%
  group_by(morph) %>%
  multi_boot_standard(col = "acc") #summary stats for acc
  
ggplot(test, aes(x = factor(morph), y = mean)) + 
  geom_bar(stat = "identity") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper)) +
  geom_hline(yintercept = .5, lty = 2) + 
  ylim(0,1) + 
  ylab("Proportion Accurate") + 
  xlab("Morph level") + 
  theme_few() +
  scale_x_discrete()
```

As a curve. 

```{r}
ggplot(test, aes(x = morph, y = mean)) + 
  geom_line() + 
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper)) +
  geom_hline(yintercept = .5, lty = 2) + 
  ylim(0,1) + 
  ylab("Proportion Accurate") + 
  xlab("Morph level") + 
  theme_few() +
  scale_x_continuous(breaks = c(60, 70, 100))
```


## By block 

```{r}
#first, group by all three variables (morph, block, sid); then everything but SID
testBlock <- d %>%
  filter(block > 0, morph > 50) %>%
  group_by(morph, block, sid) %>%
  summarise(acc = mean(acc, na.rm=TRUE)) %>%
  group_by(morph, block) %>%
  multi_boot_standard(col = "acc", na.rm=TRUE)
  
ggplot(testBlock, aes(x = morph, y = mean, col = factor(block), 
                 group = factor(block))) + 
  geom_line() + 
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper), 
                  position = position_dodge(width = 4)) + #preserve vertical position while adjusting horizontal (ease of visual understanding)
  geom_hline(yintercept = .5, lty = 2) + 
  ylim(0,1) + 
  ylab("Proportion Accurate") + 
  xlab("Morph level") + 
  scale_colour_solarized(name = "block") + 
  theme_few()+
  scale_x_continuous(breaks = c(60, 70, 100))

```

## By set 

```{r}
testSet <- d %>%
  filter(block > 0, morph > 50) %>%
  group_by(morph, set, sid) %>%
  summarise(acc = mean(acc, na.rm=TRUE)) %>%
  group_by(morph, set) %>%
  multi_boot_standard(col = "acc", na.rm=TRUE)
  
ggplot(testSet, aes(x = morph, y = mean, col = set, 
                 group = set)) + 
  geom_line() + 
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper), 
                  position = position_dodge(width = 4)) +
  geom_hline(yintercept = .5, lty = 2) + 
  ylim(0,1) + 
  ylab("Proportion Accurate") + 
  xlab("Morph level") + 
  scale_colour_solarized(name = "set") + 
  theme_few() +
  scale_x_continuous(breaks = c(60, 70, 100))

```


